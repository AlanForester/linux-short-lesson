##Управление пользователями	

####Описание многопользовательской системы, RWX-правила, пользователи и группы, su/sudo, chown/chmod, sticky and tmp bits, расширенные атрибуты.			

Под пользователем понимается любой, кто работает с компьютером. Как правило, для каждого пользователя в системе 
создаётся отдельный аккаунт, которому присваивается специальное имя. Механизм пользователей и групп используется в 
Linux для управления доступом к файлам, каталогам и периферийным устройствам. 
Стандартный контроль доступа в Linux прост и не предлагает большого выбора настроек. Механизм пользователей был 
разработан по соображениям безопасности, для ограничения доступа к различным частям системы. 

Суперпользователь (root) имеет полный доступ к операционной системе и её настройкам. 
Этот аккаунт используется только для целей системного администрирования. Обычные пользователи могут временно повысить 
уровень своих прав командами ```su``` и ```sudo```. Один человек может создать несколько аккаунтов с разными именами. 
Некоторые системные имена, вроде того же "root", зарезервированы и запрещены к использованию.

В Linux каждый файл принадлежит какому-то пользователю и группе. Существует три типа прав доступа — чтение, запись и исполнение. 
Права доступа задаются по отдельности для владельца-пользователя, владельца-группы, и для прочих пользователей, 
которые не входят в первые две категории. Владельцев файла и права доступа можно узнать с помощью "длинного" формата команды 
```ls -l /boot/```

~~~shell script
total 138432
-rw-r--r-- 1 root root   217469 Sep  4 22:23 config-4.15.0-117-generic
-rw-r--r-- 1 root root   217469 Sep  8 13:09 config-4.15.0-118-generic
drwx------ 3 root root     4096 Jan  1  1970 efi
drwxr-xr-x 5 root root     4096 Sep 23 06:19 grub
-rw-r--r-- 1 root root 58179919 Sep  9 06:40 initrd.img-4.15.0-117-generic
-rw-r--r-- 1 root root 58185594 Sep 23 06:22 initrd.img-4.15.0-118-generic
-rw------- 1 root root  4074919 Sep  4 22:23 System.map-4.15.0-117-generic
-rw------- 1 root root  4075503 Sep  8 13:09 System.map-4.15.0-118-generic
-rw------- 1 root root  8388256 Sep  4 22:33 vmlinuz-4.15.0-117-generic
-rw------- 1 root root  8388256 Sep  8 13:26 vmlinuz-4.15.0-118-generic
~~~

Первая колонка содержит права доступа к файлу (например, правами файла grub являются drwxr-xr-x). 
Третья и четвёртая колонки содержат соответственно пользователя и группу, которым принадлежит файл. 
В этом примере все файлы принадлежат пользователю root и группе root.

Права доступа отображаются тремя группами символов, которые являются правами владельца, 
группы и всех остальных. Например, строка -rw-r--r-- говорит о том, что владелец файла имеет права на чтение и запись,
но не на выполнение (rw-), а пользователи из группы-владельца и прочие пользователи имеют доступ только на чтение (r-- и r--). 
С другой стороны, строка drwxrwx--- говорит о том, что у пользователя и группы права на чтение, запись и исполнение (rwx и rwx), 
а все остальные доступа к файлу не имеют вовсе (---). Первый символ в строке означает тип файла.

#### T-бит, SUID и SGID
Помимо стандартных разрешений 'rwx', команда chmod осуществляет также управление битами SGID, SUID и T. 

В действительности, битовая маска прав доступа к файлам содержит 4 группы по 3 бита в каждой. Таким образом, 
команда chmod 755 это всего лишь краткая запись полной формы команды ```chmod 0755```

t-бит используется с каталогами. Обычно, когда t-бит для каталога не установлен, файл в данном каталоге может удалить любой пользователь, 
имеющий доступ на запись к данному файлу. Устанавливая t-бит на каталог мы меняем это правило таким образом, что 
удалить файл из каталога может только владелец этого каталога или файла.

Установить t-бит можно при помощи команд ```chmod a+tw file``` или ```chmod 1777 file```.
Атрибуты SUID и SGID позволяют изменить права пользователя при запуске на выполнения файла, имеющего эти атрибуты.
Запускаемая программа получает права доступа к системным ресурсам на основе прав доступа пользователя, запустившего
программу. Установка же флагов SUID и SGID изменяет это правило таким образом, что назначает права доступа к системным 
ресурсам исходя из прав доступа владельца файла. Т.е. запущенный исполняемый файл, которым владеет суперпользователь, 
получает права доступа к системным ресурсам на уровне суперпользователя (фактически неограниченные). При этом 
установка SUID приведет к наследованию прав владельца-пользователя файла, а установка SGID -владельца-группы.

##### Популярные значения прав доступа
```
400  (-r--------)   - Владелец имеет право чтения; никто другой не имеет права выполнять никакие действия
644  (-rw-r--r--)   - Все пользователи имеют право чтения; владелец может редактировать
660  (-rw-rw----)   - Владелец и группа могут читать и редактировать; остальные не имеют права выполнять никаких действий
664  (-rw-rw-r--)   - Все пользователи имеют право чтения; владелец и группа могут редактировать
666  (-rw-rw-rw-)   - Все пользователи могут читать и редактировать
700  (-rwx------)   - Владелец может читать, записывать и запускать на выполнение; никто другой не имеет права выполнять никакие действия
744  (-rwxr--r--)   - Каждый пользователь может читать, владелец имеет право редактировать и запускать на выполнение
755  (-rwxr-xr-x)   - Каждый пользователь имеет право читать и запускать на выполнение; владелец может редактировать
777  (-rwxrwxrwx)   - Каждый пользователь может читать, редактировать и запускать на выполнение
1555 (-r-xr-xr-t)   - Каждый пользователь имеет право читать и запускать на выполнение; удалить файл может только владелец этого файла
2555 (-r-xr-sr-x)   - Каждый пользователь имеет право читать и запускать на выполнение с правами группы (user group) владельца файла
0440 (-r--r-----)   - Владелец и группа имеет право чтения никто другой не имеет права выполнять никакие действия
4555 (-r-sr-xr-x)   - Каждый пользователь имеет право читать и запускать на выполнение с правами владельца файла
```

Изменить владельцев файла можно командой ```chown```, а права доступа меняются командой ```chmod```:
Смотрите примеры в файле users.sh 

#### Список файлов

Ни в коем случае не редактируйте эти файлы вручную. Есть специальные программы, которые обеспечивают правильную работу 
с ними и гарантируют отсутствие ошибок при изменении. 

```
/etc/shadow	Безопасное хранение информации о пользователях
/etc/passwd	Информация о пользователях
/etc/gshadow	Скрытая информация о группах
/etc/group	Принадлежность пользователей к группам
```

#### Управление пользователями
Список пользователей, которые в настоящий момент выполнили вход в систему, можно вывести командой ```who```. 
Список хранящихся в базе данных аккаунтов и их характеристик можно вывести командой ```passwd -Sa``` с правами root. 
Описание формата вывода вы найдёте в руководстве [passwd(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/passwd.1).

Добавление нового пользователя выполняется командой:
```
useradd -m -G дополнительные_группы -s оболочка_входа имя_пользователя
```

- ```-m/--create-home``` - указание создать домашний каталог пользователя по адресу /home/имя_пользователя. 
Внутри домашнего каталога обычный пользователь может без прав root создавать и удалять файлы, устанавливать программы и т.д.
- ```-G/--groups``` - список дополнительных групп, в которые должен войти новый пользователь. Группы в списке должны 
разделяться только запятыми, без пробелов. По умолчанию новый пользователь добавляется только в начальную группу (см. ниже в этом разделе).
- ```-s/--shell``` - путь к файлу оболочки входа (login shell) пользователя. После завершения загрузки системы для 
пользователя запускается оболочка входа, указанная в этом параметре. Убедитесь, что пакет с необходимой оболочкой 
установлен, если указали что-то, отличное от Bash.

Полная документация о командах [chown(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/chown.1), [chmod(1)](https://jlk.fjfi.cvut.cz/arch/manpages/man/chmod.1)

[Go back](https://github.com/AlexCollin/linux-short-lesson)